
                    ┌───┐                           ┌────────┐          ┌───────┐                      ┌───┐                                     ┌──────┐          ┌────┐          ┌────────┐
                    │org│                           │oz_inbox│          │Dropbox│                      │tmp│                                     │orgzly│          │tmp2│          │or_inbox│
                    └─┬─┘                           └───┬────┘          └───┬───┘                      └─┬─┘                                     └──┬───┘          └─┬──┘          └───┬────┘
                      │                                 │                   │                            │                                          │                │                 │
                      │                                 │                   │                            │   ╔════╗                                 │                │                 │
══════════════════════╪═════════════════════════════════╪═══════════════════╪════════════════════════════╪═══╣ up ╠═════════════════════════════════╪════════════════╪═════════════════╪════════════════════════════════════════
                      │                                 │                   │                            │   ╚════╝                                 │                │                 │
                      │                                 │                   │                            │                                          │                │                 │
                      │                                 │                   │                            │                                          │                │                 │
          ╔═══════╤═══╪═════════════════════════════════╪═══════════════════╪═════════╗                  │                                          │                │                 │
          ║ PUSH  │   │                                 │                   │         ║                  │                                          │                │                 │
          ╟───────┘   │1 org nodes added to orgzly inbox│  ╔═══════════════╗│         ║                  │                                          │                │                 │
          ║           │─────────────────────────────────>  ║prevent dupes ░║│         ║                  │                                          │                │                 │
          ╚═══════════╪═════════════════════════════════╪══╚═══════════════╝╪═════════╝                  │                                          │                │                 │
                      │                                 │                   │                            │                                          │                │                 │
                      │                                 │                   │                            │                                          │                │                 │
                      │                            ╔════╪═╤═════════════════╪════════════════════════════╪══════════════════════════════════════════╪════════════════╪═════════════════╪═════════╗
                      │                            ║ PUT  │                 │                            │                                          │                │                 │         ║
                      │                            ╟──────┘                 │ 2 files downloaded to tmp ┌┴┐  ╔═════════════════╗                    │                │                 │         ║
                      │                            ║    │                   │ ─────────────────────────>│ │  ║direct download ░║                    │                │                 │         ║
                      │                            ║    │                   │                           │ │  ╚═════════════════╝                    │                │                 │         ║
                      │                            ║    │                   │         ╔═══════════════╗ \ / 3 orgzly files compared to dropbox files│                ┌┴┐               │         ║
                      │                            ║    │                   │         ║prevent dupes ░║ │X│ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─>                │ │               │         ║
                      │                            ║    │                   │         ╚═══════════════╝ /┬\                                         │                │ │               │         ║
                      │                            ║    │                   │                            │                 4 result created in tmp2 │                \ /  ╔════════════╧╗        ║
                      │                            ║    │                   │                            │ ─────────────────────────────────────────────────────────>│X│  ║only unique ░║        ║
                      │                            ║    │                   │                            │                                          │                /┬\  ╚════════════╤╝        ║
                      │                            ║    │ ╔════════════════╗│                            │  5 tmp2 uploaded to dropbox              │                │                 │         ║
                      │                            ║    │ ║overwrite mode ░║│ <───────────────────────────────────────────────────────────────────────────────────────                 │         ║
                      │                            ╚════╪═╚════════════════╝╪════════════════════════════╪══════════════════════════════════════════╪════════════════╪═════════════════╪═════════╝
                      │                                 │                   │                            │                                          │                │                 │
                      │                                 │                   │                            │                                          │                │                 │
                      │                                 │                   │                            │  ╔══════╗                                │                │                 │
══════════════════════╪═════════════════════════════════╪═══════════════════╪════════════════════════════╪══╣ down ╠════════════════════════════════╪════════════════╪═════════════════╪════════════════════════════════════════
                      │                                 │                   │                            │  ╚══════╝                                │                │                 │
                      │                                 │                   │                            │                                          │                │                 │
                      │                                 │                   │                            │                                          │                │                 │
                      │                                 │     ╔══════╤══════╪════════════════════════════╪══════════════════════════════════════════╪════════════════╪═════╗           │
                      │                                 │     ║ GET  │      │                            │                                          │                │     ║           │
                      │                                 │     ╟──────┘      │6 dropbox downloaded to tmp┌┴┐  ╔═════════════════╗                    │                │     ║           │
                      │                                 │     ║             │ ─────────────────────────>│ │  ║direct download ░║                    │                │     ║           │
                      │                                 │     ║             │                           │ │  ╚═════════════════╝                    │                │     ║           │
                      │                                 │     ║             │         ╔═══════════════╗ \ /      7 orgzly files compared to tmp     │                │     ║           │
                      │                                 │     ║             │         ║prevent dupes ░║ │X│ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─>                │     ║           │
                      │                                 │     ║             │         ╚═══════════════╝ /┬\                                         │                │     ║           │
                      │                                 │     ║             │                            │         8 result added to orgzly         │  ╔════════╗    │     ║           │
                      │                                 │     ║             │                            │ ─────────────────────────────────────────>  ║unique ░║    │     ║           │
                      │                                 │     ╚═════════════╪════════════════════════════╪══════════════════════════════════════════╪══╚════════╝════╪═════╝           │
                      │                                 │                   │                            │                                          │                │                 │
                      │                                 │                   │                            │                                          │                │                 │
                      │                                 │                   │                            │                             ╔═══════╤════╪════════════════╪═════════════════╪═════════════════════════════╗
                      │                                 │                   │                            │                             ║ PULL  │    │                │                 │                             ║
                      │                                 │                   │                            │                             ╟───────┘    │   9 orgzly files pushed to org   │  ╔═══════════════╗          ║
                      │                                 │                   │                            │                             ║            │ ─────────────────────────────────>  ║prevent dupes ░║          ║
                      │                                 │                   │                            │                             ╚════════════╪════════════════╪═════════════════╪══╚═══════════════╝══════════╝
                    ┌─┴─┐                           ┌───┴────┐          ┌───┴───┐                      ┌─┴─┐                                     ┌──┴───┐          ┌─┴──┐          ┌───┴────┐
                    │org│                           │oz_inbox│          │Dropbox│                      │tmp│                                     │orgzly│          │tmp2│          │or_inbox│
                    └───┘                           └────────┘          └───────┘                      └───┘                                     └──────┘          └────┘          └────────┘

@startuml
autonumber

== up ==
group push
	org -> oz_inbox : org nodes added to orgzly inbox
	note right: prevent dupes
end
group put
	Dropbox o-> tmp : files downloaded to tmp
	note right: direct download
	activate tmp
	orgzly o<-->o tmp : orgzly files compared to dropbox files
	note left: prevent dupes
	activate tmp2
	tmp -> tmp2 : result created in tmp2
	note right: only unique
	destroy tmp
	tmp2 ->x Dropbox : tmp2 uploaded to dropbox
	note left: overwrite mode
	destroy tmp2
end

== down ==
group get
	tmp <- Dropbox : dropbox downloaded to tmp
	note right: direct download
	activate tmp
	orgzly o<-->o tmp : orgzly files compared to tmp
	note left: prevent dupes
	tmp -> orgzly : result added to orgzly
	note right: unique
	destroy tmp
end
group pull
	or_inbox x<- orgzly : orgzly files pushed to org
	note right: prevent dupes
end
@enduml
